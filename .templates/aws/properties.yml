---
meta:
  aws:
    access_key: (( param "Please supply an AWS Access Key" ))
    secret_key: (( param "Please supply an AWS Secret Key" ))
    region:     (( param "What AWS region are you going to use?" ))

  vcap_password: (( vault $VAULT_PREFIX "/vcap:crypt" ))
  bosh:
    blobstore:
      agent:
        pass: (( vault $VAULT_PREFIX "/blobstore/agent:password" ))
      director:
        pass: (( vault $VAULT_PREFIX "/blobstore/director:password" ))
    db:
      pass: (( vault $VAULT_PREFIX "/db:password" ))
    nats:
      pass: (( vault $VAULT_PREFIX "/nats:password" ))
    users:
      - name: admin
        password: (( vault $VAULT_PREFIX "/users/admin:password" ))
      - name: hm
        password: (( vault $VAULT_PREFIX "/users/hm:password" ))

cloud_provider:
  mbus: (( concat "https://mbus:mbus-password@" jobs.bosh.networks.default.static_ips.0 ":6868" ))

  template:
    name: aws_cpi
    release: bosh-aws-cpi

  ssh_tunnel:
    port: 22
    user: vcap
    host: (( grab jobs.bosh.networks[0].static_ips[0] ))
    private_key: (( param "What is the local path to the Amazon Private Key for this deployment?" ))

  properties:
    agent:
      mbus: https://mbus:mbus-password@0.0.0.0:6868
    blobstore:
      path: /var/vcap/micro_bosh/data/cache
      provider: local
    ntp: (( grab meta.ntp ))
    aws:
      access_key_id:           (( grab meta.aws.access_key ))
      secret_access_key:       (( grab meta.aws.secret_key ))
      default_key_name:        (( param "What is your full key name?" ))
      default_security_groups: (( param "What Security Groups?" ))
      region:                  (( grab meta.aws.region ))

properties:
  director:
    cpi_job: aws_cpi
  aws: (( grab cloud_provider.properties.aws ))
